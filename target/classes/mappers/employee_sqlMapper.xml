<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <!--
	작성자 : 
	작성일 : 
	 에서 사용하는 mapper
-->
  
  
  <mapper namespace="com.spring.Creamy_CRM.Host_dao.EmployeeDAO">
  
  <!--
	작성자 : 주수림
	작성일 : 2021-09-20
	시작
-->
  
	 <!-- 직원 목록 조회 -->
	<select id="employeeList" parameterType="String" resultType="com.spring.Creamy_CRM.VO.EmployeeVO">
		SELECT * 
		  FROM employee_tbl 
		 WHERE host_code = #{host_code}
		 ORDER BY TO_NUMBER(SUBSTR(employee_code,2)) DESC
	</select>
	
	<!-- 이미 직원 등록이 완료된 id인지 체크 -->
	<select id="chkEmployeeIdPreexisting" parameterType="String" resultType="Integer">
		SELECT COUNT(*) 
		  FROM employee_tbl 
		 WHERE employee_id = #{employee_id}
	</select>
   
   <!-- 직원 등록시 id 확인 -->
	<select id="chkEmployeeIdAction" parameterType="String" resultType="Integer">
		SELECT COUNT(*) 
		  FROM Auth_tbl 
		 WHERE ID = #{ID}
	</select>
	
	<!-- 직원 id와 pwd를 Auth 테이블에 삽입 -->
	<insert id="insertEmployeeAuth" parameterType="java.util.Map">
  		insert into Auth_tbl(ID, password, key, authority, enabled)
  		values(#{ID}, #{password}, #{key}, 'ROLE_USER', 1)
  	</insert>
   
	<!-- 직원 등록  -->
	<insert id="insertEmployee" parameterType="com.spring.Creamy_CRM.VO.EmployeeVO">
		INSERT INTO employee_tbl(employee_code, employee_id, host_code, employee_name, employee_gender, employee_age, employee_email, employee_address, 
		   				 employee_ph, employee_hireDate, employee_resginDate, department, position, duty, job, employee_type, annual_leave_cnt)
		VALUES ('E'||emp_seq.nextval, #{employee_id}, #{host_code}, #{employee_name}, #{employee_gender}, #{employee_age}, #{employee_email}, #{employee_address}, 
		    			#{employee_ph}, SYSDATE, null, #{department}, #{position}, #{duty}, #{job}, #{employee_type}, #{annual_leave_cnt})
	</insert>  	
  
  
  </mapper>