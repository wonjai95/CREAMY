<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <!--
	작성자 : 주수림
	작성일 : 2021.09.23
	 UserReservationDAOImpl에서 사용하는 mapper
-->

  <mapper namespace="com.spring.Creamy_CRM.User_dao.UserReservationDAO">
  
	<!-- 매장 목록 조회 -->
	<select id="selectHost" resultType="com.spring.Creamy_CRM.VO.HostVO">
		SELECT * FROM host_info_view 
	</select>
   	
   	<!-- 해당 사장님의 해당 요일 영업시간 조회  -->
   	<select id="getOperatingInfo" parameterType="java.util.Map" resultType="com.spring.Creamy_CRM.VO.HostVO">
   		SELECT open_sche, close_sche 
   		  FROM host_detail_view
   		 WHERE host_code = #{host_code}
   		   AND operating_day = #{operating_day}
   	</select>
   	
   	<!-- 회원 예약 가능한 담당자 표시 -->
   	<select id="getAvailableManager" parameterType="java.util.Map" resultType="com.spring.Creamy_CRM.VO.HostVO">
   		SELECT employee_code, employee_name
   		  FROM hostEmp_TimeTable_view
   		<choose>
   			<when test="selectDay == 0">
   				WHERE TO_DATE('1990/01/01'||#{selectTime}, 'YYYY-MM-dd HH24:mi') 
   				BETWEEN TO_DATE('1990/01/01'||sun_in, 'YYYY-MM-dd HH24:mi') 
   				AND TO_DATE('1990/01/01'||sun_out, 'YYYY-MM-dd HH24:mi')
   			</when>
   			<when test="selectDay == 1">
   				WHERE TO_DATE('1990/01/01'||#{selectTime}, 'YYYY-MM-dd HH24:mi') 
   				BETWEEN TO_DATE('1990/01/01'||mon_in, 'YYYY-MM-dd HH24:mi') 
   				AND TO_DATE('1990/01/01'||mon_out, 'YYYY-MM-dd HH24:mi')
   			</when>
   			<when test="selectDay == 2">
   				WHERE TO_DATE('1990/01/01'||#{selectTime}, 'YYYY-MM-dd HH24:mi') 
   				BETWEEN TO_DATE('1990/01/01'||tue_in, 'YYYY-MM-dd HH24:mi') 
   				AND TO_DATE('1990/01/01'||tue_out, 'YYYY-MM-dd HH24:mi')
   			</when>
   			<when test="selectDay == 3">
   				WHERE TO_DATE('1990/01/01'||#{selectTime}, 'YYYY-MM-dd HH24:mi') 
   				BETWEEN TO_DATE('1990/01/01'||wed_in, 'YYYY-MM-dd HH24:mi') 
   				AND TO_DATE('1990/01/01'||wed_out, 'YYYY-MM-dd HH24:mi')
   			</when>
   			<when test="selectDay == 4">
   				WHERE TO_DATE('1990/01/01'||#{selectTime}, 'YYYY-MM-dd HH24:mi') 
   				BETWEEN TO_DATE('1990/01/01'||thu_in, 'YYYY-MM-dd HH24:mi') 
   				AND TO_DATE('1990/01/01'||thu_out, 'YYYY-MM-dd HH24:mi')
   			</when>
   			<when test="selectDay == 5">
   				WHERE TO_DATE('1990/01/01'||#{selectTime}, 'YYYY-MM-dd HH24:mi') 
   				BETWEEN TO_DATE('1990/01/01'||fri_in, 'YYYY-MM-dd HH24:mi') 
   				AND TO_DATE('1990/01/01'||fri_out, 'YYYY-MM-dd HH24:mi')
   			</when>
   			<when test="selectDay == 6">
   				WHERE TO_DATE('1990/01/01'||#{selectTime}, 'YYYY-MM-dd HH24:mi') 
   				BETWEEN TO_DATE('1990/01/01'||sat_in, 'YYYY-MM-dd HH24:mi') 
   				AND TO_DATE('1990/01/01'||sat_out, 'YYYY-MM-dd HH24:mi')
   			</when>
   		</choose>
   		AND host_code = #{host_code}
   	</select>
   	
  	
  </mapper>